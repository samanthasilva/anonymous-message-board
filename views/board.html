<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Metadados de Arquivo</title>
    <link
      rel="shortcut icon"
      href="https://cdn-icons-png.flaticon.com/512/1029/1029183.png"
      type="image/x-icon"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
      type="text/css"
    />
    <link href="/public/style.css" rel="stylesheet" type="text/css" />
  </head>
  </head>
  <body>
    <header>
      <a href="/"><i class="fab fa-forumbee"></i></a>
      <h1 id="boardTitle"></h1>
    </header>

    <section id="submitNewThread" class="thread-section">
      <h3>Submit a new thread</h3>
      <form id="newThread" method="post" action="/api/threads/:board">
        <textarea
          rows="4"
          cols="120"
          placeholder="Write your thread..."
          name="text"
          required
        ></textarea>
        <br />
        <input
          type="password"
          placeholder="Enter password for future deletions"
          name="delete_password"
          required
        />
        <br />
        <input type="submit" value="Submit" class="button" />
      </form>
    </section>

    <section id="boardDisplay" class="thread-section"></section>

    <footer class="cute-footer">
      <p>
        Desenvolvido
        <a
          href="https://github.com/samanthasilva/FCC-file-metadata-microservice"
          target="_blank"
          class="heart-link"
          >‚ù§</a
        >
        por Samantha Silva
      </p>
    </footer>

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <script>
      $(function () {
        const currentBoard = window.location.pathname.slice(3, -1);
        const url = "/api/threads/" + currentBoard;
        $("#boardTitle").text("Welcome to " + currentBoard);

        // Fetch threads
        $.ajax({
          type: "GET",
          url: url,
          success: function (data) {
            let boardThreads = [];
            data.forEach(function (ele) {
              let thread = ['<div class="thread-item">'];
              thread.push(`<h3>${ele.text}</h3>`);
              thread.push(`<p>Created on: ${ele.created_on}</p>`);
              thread.push('<div class="thread-actions">');
              thread.push(
                `<form class="report-form" method="POST"><input type="hidden" name="thread_id" value="${ele._id}"/><button type="submit" class="btn-report"><i class="fas fa-flag"></i> Report</button></form>`
              );
              thread.push(
                `<form class="delete-form" method="POST"><input type="hidden" name="thread_id" value="${ele._id}"/><input type="password" name="delete_password" placeholder="Password" required/><button type="submit" class="btn-delete"><i class="fas fa-trash-alt"></i> Delete</button></form>`
              );
              thread.push("</div>"); // End of thread-actions

              thread.push('<div class="replies">');
              ele.replies.forEach(function (rep) {
                thread.push(
                  `<div class="reply-item"><p>${rep.text} <small>${rep.created_on}</small></p>`
                );
                thread.push(
                  `<form class="report-reply-form"><button type="submit" class="btn-report-reply"><i class="fas fa-flag"></i> Report Reply</button></form>`
                );
                thread.push(
                  `<form class="delete-reply-form"><input type="password" name="delete_password" placeholder="Password" required/><button type="submit" class="btn-delete-reply"><i class="fas fa-trash-alt"></i> Delete Reply</button></form></div>`
                );
              });
              thread.push("</div>"); // End of replies

              boardThreads.push(thread.join(""));
            });
            $("#boardDisplay").html(boardThreads.join(""));
          },
        });

        // Action events (like reporting and deleting threads or replies)
        $("#boardDisplay").on("submit", ".report-form, .delete-form", function (e) {
          e.preventDefault();
          // Handle reports and deletes
        });
      });
    </script>
  </body>
</html>
